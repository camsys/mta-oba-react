import React, {useContext, useEffect, useState} from "react";
import Cookies from "js-cookie";
import {RouteInterface, StopInterface} from "../../js/updateState/DataModels";
import {FavoritesCookieStateContext, useFavorite} from "../util/MiscStateComponent";
import {isRouteInterface, isStopInterface} from "../../js/updateState/DataModelsUtils";
import {useSearch} from "../../js/updateState/SearchEffect";


export const FavoriteItem = ({datum}) =>{
    let {removeFavorite} = useFavorite();
    let {search} = useSearch()


    if(isRouteInterface(datum)){
        let routeDatum = datum as RouteInterface
        return(<li>
            <button className={`favorite-route route-border-left ${routeDatum.routeId.split("_")[1]}`}
               tabIndex="-1" onClick={()=>{search(routeDatum.routeId)}}>
                                        <span className="label" style={{ borderColor: '#'+routeDatum.color }}>
                                            <strong>{routeDatum.routeId.split("_")[1]}</strong> {routeDatum.routeTitle}
                                        </span>
            </button>
            <ul className="menu icon-menu sub-menu-menu">
                    <li>
                        <button className="favorite-toggle" tabIndex="-1" aria-label='Toggle favorites status for this route' onClick={()=>{removeFavorite(datum)}}>
                            <span className="svg-icon-wrap">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g fill="#0E61A9" clipPath="url(#a)"><path d="M8.75001 14.9417C8.7503 14.9031 8.73944 14.8653 8.71875 14.8328C8.69805 14.8002 8.66839 14.7744 8.63334 14.7583C8.60144 14.7365 8.56368 14.7248 8.52501 14.7248C8.48634 14.7248 8.44857 14.7365 8.41667 14.7583L5.60001 16.8333C5.56585 16.8611 5.52318 16.8762 5.47917 16.8762C5.43517 16.8762 5.3925 16.8611 5.35834 16.8333C5.32056 16.8093 5.29237 16.7728 5.27867 16.7302C5.26497 16.6876 5.26662 16.6415 5.28334 16.6L6.75001 12.2083C6.80389 12.0486 6.80805 11.8762 6.76193 11.714C6.7158 11.5519 6.62157 11.4075 6.49167 11.3L2.85001 8.28333C2.81758 8.25687 2.79387 8.22125 2.78198 8.18111C2.77009 8.14098 2.77056 8.09819 2.78334 8.05833C2.79848 8.01729 2.82569 7.98179 2.86138 7.9565C2.89708 7.93122 2.9396 7.91733 2.98334 7.91667H7.20834C7.3806 7.91598 7.54842 7.86192 7.6887 7.76194C7.82898 7.66195 7.93483 7.52095 7.99167 7.35833L9.50834 3.05833C9.52096 3.01506 9.54728 2.97705 9.58334 2.95C9.6194 2.92295 9.66326 2.90833 9.70834 2.90833C9.75342 2.90833 9.79728 2.92295 9.83334 2.95C9.8694 2.97705 9.89572 3.01506 9.90834 3.05833L11.425 7.35833C11.4819 7.52095 11.5877 7.66195 11.728 7.76194C11.8683 7.86192 12.0361 7.91598 12.2083 7.91667H16.4333C16.4759 7.91784 16.5172 7.93205 16.5514 7.95738C16.5857 7.98272 16.6114 8.01795 16.625 8.05833C16.6413 8.09705 16.6444 8.14003 16.6338 8.18068C16.6233 8.22134 16.5997 8.2574 16.5667 8.28333L16.2583 8.54167C16.2275 8.56583 16.2041 8.5982 16.1909 8.63504C16.1776 8.67189 16.175 8.71174 16.1833 8.75C16.1949 8.78638 16.2154 8.81923 16.2431 8.84547C16.2708 8.87171 16.3047 8.89047 16.3417 8.9C16.8056 9.00263 17.2559 9.15925 17.6833 9.36667C17.7169 9.3882 17.756 9.39965 17.7958 9.39965C17.8357 9.39965 17.8748 9.3882 17.9083 9.36667L18.975 8.48333C19.1706 8.31612 19.3099 8.09259 19.3737 7.84328C19.4376 7.59398 19.4229 7.33104 19.3318 7.09037C19.2406 6.8497 19.0774 6.64304 18.8644 6.4986C18.6514 6.35416 18.399 6.27898 18.1417 6.28333H12.8L10.875 0.833333C10.7906 0.590851 10.633 0.380507 10.4241 0.231267C10.2152 0.0820262 9.9651 0.00122879 9.70834 0C9.45102 0.00310259 9.20075 0.0845067 8.99085 0.233376C8.78094 0.382245 8.62136 0.591517 8.53334 0.833333L6.61667 6.25H1.25001C0.992114 6.25072 0.740757 6.3312 0.530397 6.48039C0.320037 6.62958 0.160971 6.84019 0.0750071 7.08333C-0.0113524 7.32592 -0.0217249 7.58907 0.0452722 7.8377C0.112269 8.08634 0.253453 8.30865 0.450007 8.475L5.00001 12.225L3.08334 17.9333C3.00009 18.1841 2.99842 18.4547 3.07858 18.7065C3.15874 18.9582 3.3166 19.1781 3.5295 19.3345C3.74241 19.491 3.9994 19.5759 4.2636 19.5772C4.52779 19.5785 4.7856 19.496 5.00001 19.3417L8.80834 16.5417C8.84066 16.5185 8.86568 16.4866 8.88045 16.4497C8.89522 16.4128 8.89911 16.3724 8.89167 16.3333C8.79796 15.8951 8.75048 15.4482 8.75001 15V14.9417Z"/><path d="M15 10C14.0111 10 13.0444 10.2932 12.2222 10.8427C11.3999 11.3921 10.759 12.173 10.3806 13.0866C10.0022 14.0002 9.90315 15.0055 10.0961 15.9755C10.289 16.9454 10.7652 17.8363 11.4645 18.5355C12.1637 19.2348 13.0546 19.711 14.0246 19.9039C14.9945 20.0969 15.9998 19.9978 16.9134 19.6194C17.827 19.241 18.6079 18.6001 19.1573 17.7779C19.7068 16.9556 20 15.9889 20 15C20 13.6739 19.4732 12.4021 18.5355 11.4645C17.5979 10.5268 16.3261 10 15 10ZM16.6667 15.625H13.3333C13.1676 15.625 13.0086 15.5592 12.8914 15.4419C12.7742 15.3247 12.7083 15.1658 12.7083 15C12.7083 14.8342 12.7742 14.6753 12.8914 14.5581C13.0086 14.4408 13.1676 14.375 13.3333 14.375H16.6667C16.8324 14.375 16.9914 14.4408 17.1086 14.5581C17.2258 14.6753 17.2917 14.8342 17.2917 15C17.2917 15.1658 17.2258 15.3247 17.1086 15.4419C16.9914 15.5592 16.8324 15.625 16.6667 15.625Z"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0H20V20H0z"/></clipPath></defs></svg>
                            </span>
                            Remove Route from Favorites
                        </button>
                    </li>
                </ul>
        </li>)
    }

    if(isStopInterface(datum)){
        let stopDatum = datum as StopInterface
        return(
            <li>
                <button className="favorite-stop" tabIndex="-1" onClick={()=>{search(stopDatum.id)}}>
                    <span className="label"><strong>{stopDatum.id.split("_")[1]}</strong> {stopDatum.name}</span>
                </button>
                <ul className="menu icon-menu sub-menu-menu">
                    <li>
                        <button className="favorite-toggle" tabIndex="-1" aria-label='Toggle favorites status for this stop' onClick={()=>{removeFavorite(datum)}}>
                            <span className="svg-icon-wrap">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g fill="#0E61A9" clipPath="url(#a)"><path d="M8.75001 14.9417C8.7503 14.9031 8.73944 14.8653 8.71875 14.8328C8.69805 14.8002 8.66839 14.7744 8.63334 14.7583C8.60144 14.7365 8.56368 14.7248 8.52501 14.7248C8.48634 14.7248 8.44857 14.7365 8.41667 14.7583L5.60001 16.8333C5.56585 16.8611 5.52318 16.8762 5.47917 16.8762C5.43517 16.8762 5.3925 16.8611 5.35834 16.8333C5.32056 16.8093 5.29237 16.7728 5.27867 16.7302C5.26497 16.6876 5.26662 16.6415 5.28334 16.6L6.75001 12.2083C6.80389 12.0486 6.80805 11.8762 6.76193 11.714C6.7158 11.5519 6.62157 11.4075 6.49167 11.3L2.85001 8.28333C2.81758 8.25687 2.79387 8.22125 2.78198 8.18111C2.77009 8.14098 2.77056 8.09819 2.78334 8.05833C2.79848 8.01729 2.82569 7.98179 2.86138 7.9565C2.89708 7.93122 2.9396 7.91733 2.98334 7.91667H7.20834C7.3806 7.91598 7.54842 7.86192 7.6887 7.76194C7.82898 7.66195 7.93483 7.52095 7.99167 7.35833L9.50834 3.05833C9.52096 3.01506 9.54728 2.97705 9.58334 2.95C9.6194 2.92295 9.66326 2.90833 9.70834 2.90833C9.75342 2.90833 9.79728 2.92295 9.83334 2.95C9.8694 2.97705 9.89572 3.01506 9.90834 3.05833L11.425 7.35833C11.4819 7.52095 11.5877 7.66195 11.728 7.76194C11.8683 7.86192 12.0361 7.91598 12.2083 7.91667H16.4333C16.4759 7.91784 16.5172 7.93205 16.5514 7.95738C16.5857 7.98272 16.6114 8.01795 16.625 8.05833C16.6413 8.09705 16.6444 8.14003 16.6338 8.18068C16.6233 8.22134 16.5997 8.2574 16.5667 8.28333L16.2583 8.54167C16.2275 8.56583 16.2041 8.5982 16.1909 8.63504C16.1776 8.67189 16.175 8.71174 16.1833 8.75C16.1949 8.78638 16.2154 8.81923 16.2431 8.84547C16.2708 8.87171 16.3047 8.89047 16.3417 8.9C16.8056 9.00263 17.2559 9.15925 17.6833 9.36667C17.7169 9.3882 17.756 9.39965 17.7958 9.39965C17.8357 9.39965 17.8748 9.3882 17.9083 9.36667L18.975 8.48333C19.1706 8.31612 19.3099 8.09259 19.3737 7.84328C19.4376 7.59398 19.4229 7.33104 19.3318 7.09037C19.2406 6.8497 19.0774 6.64304 18.8644 6.4986C18.6514 6.35416 18.399 6.27898 18.1417 6.28333H12.8L10.875 0.833333C10.7906 0.590851 10.633 0.380507 10.4241 0.231267C10.2152 0.0820262 9.9651 0.00122879 9.70834 0C9.45102 0.00310259 9.20075 0.0845067 8.99085 0.233376C8.78094 0.382245 8.62136 0.591517 8.53334 0.833333L6.61667 6.25H1.25001C0.992114 6.25072 0.740757 6.3312 0.530397 6.48039C0.320037 6.62958 0.160971 6.84019 0.0750071 7.08333C-0.0113524 7.32592 -0.0217249 7.58907 0.0452722 7.8377C0.112269 8.08634 0.253453 8.30865 0.450007 8.475L5.00001 12.225L3.08334 17.9333C3.00009 18.1841 2.99842 18.4547 3.07858 18.7065C3.15874 18.9582 3.3166 19.1781 3.5295 19.3345C3.74241 19.491 3.9994 19.5759 4.2636 19.5772C4.52779 19.5785 4.7856 19.496 5.00001 19.3417L8.80834 16.5417C8.84066 16.5185 8.86568 16.4866 8.88045 16.4497C8.89522 16.4128 8.89911 16.3724 8.89167 16.3333C8.79796 15.8951 8.75048 15.4482 8.75001 15V14.9417Z"/><path d="M15 10C14.0111 10 13.0444 10.2932 12.2222 10.8427C11.3999 11.3921 10.759 12.173 10.3806 13.0866C10.0022 14.0002 9.90315 15.0055 10.0961 15.9755C10.289 16.9454 10.7652 17.8363 11.4645 18.5355C12.1637 19.2348 13.0546 19.711 14.0246 19.9039C14.9945 20.0969 15.9998 19.9978 16.9134 19.6194C17.827 19.241 18.6079 18.6001 19.1573 17.7779C19.7068 16.9556 20 15.9889 20 15C20 13.6739 19.4732 12.4021 18.5355 11.4645C17.5979 10.5268 16.3261 10 15 10ZM16.6667 15.625H13.3333C13.1676 15.625 13.0086 15.5592 12.8914 15.4419C12.7742 15.3247 12.7083 15.1658 12.7083 15C12.7083 14.8342 12.7742 14.6753 12.8914 14.5581C13.0086 14.4408 13.1676 14.375 13.3333 14.375H16.6667C16.8324 14.375 16.9914 14.4408 17.1086 14.5581C17.2258 14.6753 17.2917 14.8342 17.2917 15C17.2917 15.1658 17.2258 15.3247 17.1086 15.4419C16.9914 15.5592 16.8324 15.625 16.6667 15.625Z"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0H20V20H0z"/></clipPath></defs></svg>
                            </span>
                            Remove Stop from Favorites
                        </button>
                    </li>
                </ul>
            </li>
        )
    }
}

export const FavoritesMenu = () => {

    // Cookies.set('favorites', "{\"favorites\":[{\"color\":\"00AEEF\",\"description\":\"via 86th St \\/ Ocean Pkwy\",\"routeId\":\"MTA NYCT_B1\",\"longName\":\"Bay Ridge - Manhattan Beach\",\"routeTitle\":\"B1\",\"textColor\":\"FFFFFF\",\"type\":3}]}")
    // Cookies.set('favorites', "{\"favorites\":[{\"name\":\"00AEEF\",\"longLat\":[100,94],\"id\":\"MTA NYCT_B1\",\"stopDirection\":\"Bay Ridge - Manhattan Beach\"")

    const {favoritesState} = useContext(FavoritesCookieStateContext)
    const [, setForceUpdate] = useState(0);
    useEffect(() => {
        setForceUpdate(n => n + 1);
    }, [favoritesState]);


    // let {jsonCookie} = useJsonCookie("favorites")
    console.log("favorites cookie:")
    console.log("favorites cookie:", favoritesState)

    return(<li className="parent collapsible">
        <button id="favorites-menu-trigger" className="sub-menu-trigger collapse-trigger" aria-haspopup="true" aria-expanded="false" aria-label="Toggle Favorites Menu">
                                <span className="svg-icon-wrap" role="presentation" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                        <path className="blue" d="M19.845 7.217a1.348 1.348 0 0 0-1.252-.87h-5.4L11.253.87a1.33 1.33 0 0 0-2.495 0l-1.93 5.47h-5.4a1.33 1.33 0 0 0-.87 2.356l4.583 3.791-1.913 5.757a1.33 1.33 0 0 0 2.052 1.496l4.73-3.479 4.73 3.479a1.33 1.33 0 0 0 2.053-1.496l-1.922-5.757 4.592-3.8a1.34 1.34 0 0 0 .382-1.47Z"/>
                                        <path className="yellow" d="M13.196 11.36a.87.87 0 0 0-.279.982l1.4 4.226a.217.217 0 0 1-.078.252.227.227 0 0 1-.27 0l-3.478-2.539a.948.948 0 0 0-.539-.174.93.93 0 0 0-.539.174L5.97 16.83a.226.226 0 0 1-.27 0 .218.218 0 0 1-.078-.26l1.4-4.227a.87.87 0 0 0-.279-.982L3.265 8.438a.217.217 0 0 1-.07-.252.226.226 0 0 1 .21-.157H7.43a.913.913 0 0 0 .87-.6l1.46-4.157a.235.235 0 0 1 .436 0l1.46 4.157a.914.914 0 0 0 .87.6h4.061a.235.235 0 0 1 .217.157.218.218 0 0 1-.07.252l-3.538 2.921Z"/>
                                    </svg>
                                </span>
            <span className="label">Favorites</span>
        </button>
        <ul className="sub-menu menu collapse-content" id="favorites-menu" style={{ maxHeight: '0px' }} role="menu">
            {favoritesState.favorites.map((datum,index)=>{return <FavoriteItem datum={datum} key = {index}/>})}
        </ul>
    </li>)
}